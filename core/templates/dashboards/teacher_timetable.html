{% extends 'base.html' %}
{% load dict_get %}

{% block content %}
<style>
@media print {
  body, html { background: #fff !important; margin: 0 !important; padding: 0 !important; }
  .sidebar-custom, .navbar, .d-print-none, .alert, .form-select, .input-group, form, .row.mb-3 { display: none !important; }
  .container-fluid, .card, .card-header, .card-body, #timetable-table { display: block !important; background: #fff !important; color: #000 !important; box-shadow: none !important; margin: 0 auto !important; padding: 0 !important; width: 100% !important; max-width: 900px; border: none !important; }
  #timetable-table { font-size: 13px; }
  h1, h3, th, td, strong, small { color: #000 !important; }
  @page { margin: 1cm; }
}
</style>

<div class="container-fluid">
  <div class="d-flex align-items-center justify-content-between mt-4 mb-2">
    <h1 class="mb-0">My Timetable</h1>
    <button class="btn btn-outline-primary d-print-none" onclick="window.print()">
      <i class="bi bi-printer"></i> Print
    </button>
  </div>

  <div class="mb-3">
    <div class="card">
      <div class="card-header d-flex justify-content-between align-items-center">
        <h3 class="mb-0">{{ teacher.user.get_full_name|default:teacher.user.username }}</h3>
        <span class="text-muted">Weekly View</span>
      </div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-bordered text-center" id="timetable-table">
            <thead>
              <tr>
                <th>Period</th>
                {% for day in days %}
                  <th>{{ day }}</th>
                {% endfor %}
              </tr>
            </thead>
            <tbody>
              {% for period in periods %}
                <tr>
                  <td>
                    <strong>{{ period.name|default:period.label }}</strong><br>
                    <small class="text-muted">{{ period.start_time|time:"g:i A" }} - {{ period.end_time|time:"g:i A" }}</small>
                  </td>
                  {% for day in days %}
                    {% with entry=timetable_grid|dict_get:period.id|dict_get:day %}
                    <td class="timeslot">
                      {% if entry %}
                        <div class="slot-content">
                          <strong>{{ entry.subject.code|default:entry.subject.name }}</strong><br>
                          <small class="text-muted">{{ entry.class_group.name }}</small>
                        </div>
                      {% else %}
                        <span class="text-muted">--</span>
                      {% endif %}
                    </td>
                    {% endwith %}
                  {% endfor %}
                </tr>
                {% if forloop.counter == 2 %}
                <tr>
                  <td></td>
                  <td colspan="{{ days|length }}" class="table-info text-center"><strong>Short Break</strong></td>
                </tr>
                {% elif forloop.counter == 4 %}
                <tr>
                  <td></td>
                  <td colspan="{{ days|length }}" class="table-info text-center"><strong>Long Break</strong></td>
                </tr>
                {% elif forloop.counter == 6 %}
                <tr>
                  <td></td>
                  <td colspan="{{ days|length }}" class="table-info text-center"><strong>Lunch</strong></td>
                </tr>
                {% endif %}
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
