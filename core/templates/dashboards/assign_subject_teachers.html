{% extends 'base.html' %}
{% block title %}Assign Subject Teachers{% endblock %}
{% block content %}
<div class="container-fluid">
  <h1 class="mb-3">Assign Subject Teachers</h1>
  <div class="mb-2 text-muted">
    <strong>Class:</strong> {{ class_obj.name }} (Level {{ class_obj.level }})
  </div>

  <div class="card shadow-sm">
    <div class="card-header bg-light">
      <div class="d-flex justify-content-between align-items-center">
        <h5 class="mb-0">Subjects in this Class</h5>
        <div>
          <a href="{% url 'manage_class_subjects' class_obj.id %}" class="btn btn-sm btn-outline-secondary">Manage Subjects</a>
          <a href="{% url 'class_profile' class_obj.id %}" class="btn btn-sm btn-outline-primary ms-1">Back to Class</a>
        </div>
      </div>
    </div>
    <div class="card-body">
      {% if rows %}
      <form method="post" class="table-responsive">
        {% csrf_token %}
        <table class="table table-sm align-middle">
          <thead>
            <tr>
              <th style="width:40%">Subject</th>
              <th style="width:45%">Teacher</th>
              <th style="width:15%" class="text-muted">Current</th>
            </tr>
          </thead>
          <tbody>
            {% for row in rows %}
              <tr>
                <td>{{ row.subject.name }}</td>
                <td>
                  <select name="teacher_for_{{ row.subject.id }}" class="form-select form-select-sm">
                    <option value="">-- None --</option>
                    {% for t in row.teachers %}
                      <option value="{{ t.id }}" {% if row.selected_id and row.selected_id == t.id %}selected{% endif %}>
                        {{ t.user.get_full_name|default:t.user.username }}
                      </option>
                    {% endfor %}
                  </select>
                  {% if not row.teachers %}
                    <div class="form-text">No teachers linked to this subject yet. Add subjects to teachers in their profiles.</div>
                  {% endif %}
                </td>
                <td class="text-muted small">
                  {% if row.selected_id %}
                    Assigned
                  {% else %}
                    Not assigned
                  {% endif %}
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
        <div class="mt-3">
          <button type="submit" class="btn btn-success">Save Changes</button>
          <a href="{% url 'class_profile' class_obj.id %}" class="btn btn-outline-secondary ms-2">Cancel</a>
        </div>
      </form>
      {% else %}
        <div class="alert alert-info">
          This class has no subjects yet. Use the "Manage Subjects" button to add subjects first.
        </div>
      {% endif %}
    </div>
  </div>
</div>

{% endblock %}
