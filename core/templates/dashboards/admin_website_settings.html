{% extends 'base.html' %}
{% block title %}Website Settings{% endblock %}
{% block content %}
<div class="container mt-3" style="max-width: 920px;" id="websiteSettingsAccordion">
  <h3 class="mb-3">Website Settings</h3>
  {% if messages %}
    <div class="mb-2">
      {% for message in messages %}
        <div class="alert alert-{{ message.tags }} mb-2" role="alert">{{ message }}</div>
      {% endfor %}
    </div>
  {% endif %}

  {# Per-category Modals: Edit and Delete #}
  {% for c in categories %}
  <div class="modal fade" id="editCategoryModal-{{ c.id }}" tabindex="-1" aria-labelledby="editCategoryLabel-{{ c.id }}" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="editCategoryLabel-{{ c.id }}">Edit Category Â· {{ c.name }}</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="row g-3">
            <div class="col-md-5">
              <form method="post" class="row g-3">
                {% csrf_token %}
                <input type="hidden" name="category_id" value="{{ c.id }}" />
                <div class="col-12">
                  <label class="form-label">Name</label>
                  <input type="text" name="name" class="form-control" value="{{ c.name }}" required />
                </div>
                <div class="col-12">
                  <!-- Link URL removed from UI (auto-generated internally) -->
                </div>
                <div class="col-12">
                  <label class="form-label">Description</label>
                  <textarea name="description" class="form-control" rows="3">{{ c.description }}</textarea>
                </div>
                <div class="col-12">
                  <label class="form-label">Video Side Text <small class="text-muted">(shown next to video)</small></label>
                  <textarea name="video_side_text" class="form-control" rows="4">{{ c.video_side_text }}</textarea>
                  <div class="form-text">Used primarily when Template is Video.</div>
                </div>
                <div class="col-md-6">
                  <label class="form-label">Template</label>
                  <select name="template" class="form-select">
                    <option value="card" {% if c.template == 'card' %}selected{% endif %}>Card Grid</option>
                    <option value="feature" {% if c.template == 'feature' %}selected{% endif %}>Feature Block</option>
                    <option value="highlight" {% if c.template == 'highlight' %}selected{% endif %}>Highlight Banner</option>
                    <option value="single_photo" {% if c.template == 'single_photo' %}selected{% endif %}>Single Photo</option>
                    <option value="gallery" {% if c.template == 'gallery' %}selected{% endif %}>Photo Gallery</option>
                    <option value="video" {% if c.template == 'video' %}selected{% endif %}>Video</option>
                    <option value="file" {% if c.template == 'file' %}selected{% endif %}>Download File</option>
                    <option value="all_media" {% if c.template == 'all_media' %}selected{% endif %}>All Media</option>
                  </select>
                </div>
                <div class="col-md-3">
                  <label class="form-label">Order</label>
                  <input type="number" name="order" class="form-control" value="{{ c.order }}" min="0" />
                </div>
                <div class="col-md-3 d-flex align-items-end">
                  <div class="form-check">
                    <input type="checkbox" class="form-check-input" id="is_active_{{ c.id }}" name="is_active" {% if c.is_active %}checked{% endif %} />
                    <label class="form-check-label" for="is_active_{{ c.id }}">Active</label>
                  </div>
                </div>
                <div class="col-12 d-flex gap-2">
                  <button type="submit" name="save_category" class="btn btn-primary">Save</button>
                  <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
                </div>
              </form>
            </div>
            <div class="col-md-7">
              <div class="border rounded p-3 bg-light">
                <div class="mb-2"><strong>Preview</strong> <span class="text-muted">(current saved data)</span></div>
                {% include c.template_path with c=c %}
              </div>
              {% if c.template == 'video' %}
              <div class="border rounded p-3 mt-3">
                <div class="d-flex justify-content-between align-items-center mb-2">
                  <strong>Support Text</strong>
                  <small class="text-muted">Shown on the right side of the video</small>
                </div>
                <form method="post" class="row g-2">
                  {% csrf_token %}
                  <input type="hidden" name="category_id" value="{{ c.id }}" />
                  <div class="col-12">
                    <textarea name="video_side_text" class="form-control" rows="5" placeholder="Enter support text for this video...">{{ c.video_side_text }}</textarea>
                  </div>
                  <div class="col-12">
                    <button type="submit" name="save_video_side_text" class="btn btn-sm btn-primary">Save Support Text</button>
                  </div>
                </form>
              </div>
              {% endif %}
              {% if c.template == 'gallery' %}
              <div class="border rounded p-3 mt-3">
                <div class="d-flex justify-content-between align-items-center mb-2">
                  <strong>Upload Photos</strong>
                  <small class="text-muted">Select multiple images to add to this gallery</small>
                </div>
                <form method="post" enctype="multipart/form-data" class="row g-2">
                  {% csrf_token %}
                  <input type="hidden" name="category" value="{{ c.id }}" />
                  <div class="col-12">
                    <label class="form-label">Images</label>
                    <input type="file" name="images" accept="image/*" class="form-control" multiple required />
                    <div class="form-text">You can select more than one image.</div>
                  </div>
                  <div class="col-md-8">
                    <label class="form-label">Caption (optional, applied to all)</label>
                    <input type="text" name="caption" class="form-control" />
                  </div>
                  <div class="col-md-4">
                    <label class="form-label">Starting Order</label>
                    <input type="number" name="order" class="form-control" value="0" min="0" />
                  </div>
                  <div class="col-12">
                    <button type="submit" name="add_gallery_images" class="btn btn-sm btn-primary">Upload Images</button>
                  </div>
                </form>
              </div>
              {% elif c.template == 'single_photo' %}
              <div class="border rounded p-3 mt-3">
                <div class="d-flex justify-content-between align-items-center mb-2">
                  <strong>Upload Photo</strong>
                  <small class="text-muted">Attach a single image</small>
                </div>
                <form method="post" enctype="multipart/form-data" class="row g-2">
                  {% csrf_token %}
                  <input type="hidden" name="category" value="{{ c.id }}" />
                  <div class="col-md-6">
                    <label class="form-label">Image</label>
                    <input type="file" name="image" accept="image/*" class="form-control" required />
                  </div>
                  <div class="col-md-4">
                    <label class="form-label">Caption (optional)</label>
                    <input type="text" name="caption" class="form-control" />
                  </div>
                  <div class="col-md-2">
                    <label class="form-label">Order</label>
                    <input type="number" name="order" class="form-control" value="0" min="0" />
                  </div>
                  <div class="col-12">
                    <button type="submit" name="add_single_photo" class="btn btn-sm btn-primary">Upload Photo</button>
                  </div>
                </form>
              </div>
              {% elif c.template == 'video' %}
              <div class="border rounded p-3 mt-3">
                <div class="d-flex justify-content-between align-items-center mb-2">
                  <strong>Upload Video</strong>
                  <small class="text-muted">Attach a single video file</small>
                </div>
                <form method="post" enctype="multipart/form-data" class="row g-2">
                  {% csrf_token %}
                  <input type="hidden" name="category" value="{{ c.id }}" />
                  <div class="col-md-6">
                    <label class="form-label">Video File</label>
                    <input type="file" name="video_file" accept="video/*" class="form-control" required />
                  </div>
                  <div class="col-md-4">
                    <label class="form-label">Caption (optional)</label>
                    <input type="text" name="caption" class="form-control" />
                  </div>
                  <div class="col-md-2">
                    <label class="form-label">Order</label>
                    <input type="number" name="order" class="form-control" value="0" min="0" />
                  </div>
                  <div class="col-12">
                    <button type="submit" name="add_video_file" class="btn btn-sm btn-primary">Upload Video</button>
                  </div>
                </form>
              </div>
              {% endif %}
              <!-- Universal PDF upload (available for any template) -->
              <div class="border rounded p-3 mt-3">
                <div class="d-flex justify-content-between align-items-center mb-2">
                  <strong>Upload PDF(s)</strong>
                  <small class="text-muted">Select one or more PDF files</small>
                </div>
                <form method="post" enctype="multipart/form-data" class="row g-2">
                  {% csrf_token %}
                  <input type="hidden" name="category" value="{{ c.id }}" />
                  <div class="col-md-8">
                    <label class="form-label">PDF Files</label>
                    <input type="file" name="pdfs" accept="application/pdf,.pdf" class="form-control" multiple required />
                  </div>
                  <div class="col-md-2">
                    <label class="form-label">Starting Order</label>
                    <input type="number" name="order" class="form-control" value="0" min="0" />
                  </div>
                  <div class="col-md-12">
                    <label class="form-label">Caption (optional, applied to all)</label>
                    <input type="text" name="caption" class="form-control" />
                  </div>
                  <div class="col-12">
                    <button type="submit" name="add_pdf_files" class="btn btn-sm btn-primary">Upload PDF(s)</button>
                  </div>
                </form>
              </div>
              <!-- Existing files list with delete buttons -->
              <div class="border rounded p-3 mt-3">
                <div class="mb-2"><strong>Files</strong></div>
                <ul class="list-group">
                  {% with has_files=false %}
                  {% for m in c.media.all %}
                    {% if m.kind == 'file' and m.file %}
                      {% if not has_files %}{% with has_files=true %}{% endwith %}{% endif %}
                      <li class="list-group-item d-flex justify-content-between align-items-center">
                        <a href="{{ m.file.url }}" target="_blank">{{ m.file.name|cut:'category_media/files/' }}</a>
                        <form method="post" class="ms-2">
                          {% csrf_token %}
                          <input type="hidden" name="media_id" value="{{ m.id }}" />
                          <button type="submit" name="delete_media" class="btn btn-sm btn-outline-danger">Delete</button>
                        </form>
                      </li>
                    {% endif %}
                  {% empty %}
                    <li class="list-group-item text-muted">No files available.</li>
                  {% endfor %}
                  {% endwith %}
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="deleteCategoryModal-{{ c.id }}" tabindex="-1" aria-labelledby="deleteCategoryLabel-{{ c.id }}" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="deleteCategoryLabel-{{ c.id }}">Delete Category Â· {{ c.name }}</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="row g-3">
            <div class="col-md-5">
              <p class="mb-3">Are you sure you want to delete <strong>{{ c.name }}</strong>? This cannot be undone.</p>
              <form method="post" class="d-flex gap-2">
                {% csrf_token %}
                <input type="hidden" name="category_id" value="{{ c.id }}" />
                <button type="submit" name="delete_category" class="btn btn-danger">Delete</button>
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
              </form>
            </div>
            <div class="col-md-7">
              <div class="border rounded p-3 bg-light">
                <div class="mb-2"><strong>Preview</strong></div>
                {% include c.template_path with c=c %}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  {% endfor %}

  <div class="shadow-sm bg-white rounded-3 mt-3">
    <div class="p-3 border-bottom d-flex justify-content-between align-items-center">
      <div class="d-flex align-items-center gap-3">
        <h5 class="mb-0">Category Media</h5>
        <small class="text-muted">Upload images, videos, or files and attach to a category</small>
      </div>
      <button class="btn btn-sm btn-outline-secondary" type="button" data-bs-toggle="collapse" data-bs-target="#collapseCategoryMedia" aria-expanded="true" aria-controls="collapseCategoryMedia">
        <i class="bi bi-chevron-down"></i>
      </button>
    </div>
    <div id="collapseCategoryMedia" class="collapse" data-bs-parent="#websiteSettingsAccordion">
      <div class="p-3">
      <form method="post" enctype="multipart/form-data" class="row g-3">
        {% csrf_token %}
        <div class="col-md-3">
          <label class="form-label">Category</label>
          {{ media_form.category }}
        </div>
        <div class="col-md-2">
          <label class="form-label">Kind</label>
          {{ media_form.kind }}
        </div>
        <div class="col-md-3">
          <label class="form-label">Image (optional)</label>
          {{ media_form.image }}
        </div>
        <div class="col-md-3">
          <label class="form-label">File (optional)</label>
          {{ media_form.file }}
        </div>
        <div class="col-md-6">
          <label class="form-label">Video URL (optional)</label>
          {{ media_form.video_url }}
        </div>
        <div class="col-md-4">
          <label class="form-label">Caption</label>
          {{ media_form.caption }}
        </div>
        <div class="col-md-2">
          <label class="form-label">Order</label>
          {{ media_form.order }}
        </div>
        <div class="col-12">
          <button type="submit" name="add_category_media" class="btn btn-primary">Add Media</button>
        </div>
      </form>

      <div class="table-responsive mt-3">
        <table class="table align-middle">
          <thead>
            <tr>
              <th>#</th>
              <th>Category</th>
              <th>Kind</th>
              <th>Preview</th>
              <th>Caption</th>
              <th>Order</th>
            </tr>
          </thead>
          <tbody>
            {% for m in media_items %}
            <tr>
              <td>{{ forloop.counter }}</td>
              <td>{{ m.category.name }}</td>
              <td>{{ m.kind }}</td>
              <td>
                {% if m.kind == 'image' and m.image %}
                  <img src="{{ m.image.url }}" alt="" style="height:48px; border-radius:6px;"/>
                {% elif m.kind == 'video' and m.video_url %}
                  <a href="{{ m.video_url }}" target="_blank">Video Link</a>
                {% elif m.kind == 'file' and m.file %}
                  <a href="{{ m.file.url }}" target="_blank">Download</a>
                {% else %}
                  <span class="text-muted">â</span>
                {% endif %}
              </td>
              <td>{{ m.caption }}</td>
              <td>{{ m.order }}</td>
            </tr>
            {% empty %}
            <tr><td colspan="6" class="text-muted">No media uploaded yet.</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      </div>
    </div>
  </div>
  <form method="post" enctype="multipart/form-data" class="shadow-sm bg-white rounded-3">
    {% csrf_token %}
    <div class="p-3 border-bottom">
      <div class="d-flex justify-content-between align-items-center">
        <h5 class="mb-0">General</h5>
        <button class="btn btn-sm btn-outline-secondary" type="button" data-bs-toggle="collapse" data-bs-target="#collapseGeneral" aria-expanded="true" aria-controls="collapseGeneral">
          <i class="bi bi-chevron-down"></i>
        </button>
      </div>
      <div id="collapseGeneral" class="collapse mt-3" data-bs-parent="#websiteSettingsAccordion">
      <div class="row g-3">
        <div class="col-md-6">
          <label class="form-label">School Name</label>
          {{ form.school_name }}
        </div>
        <div class="col-md-6">
          <label class="form-label">School Motto</label>
          {{ form.school_motto }}
        </div>
        <div class="col-12">
          <label class="form-label">School Aim</label>
          {{ form.school_aim }}
        </div>
      </div>
      </div>
    </div>

    <div class="p-3 border-bottom">
      <div class="d-flex justify-content-between align-items-center">
        <h5 class="mb-0">Branding & Colors</h5>
        <button class="btn btn-sm btn-outline-secondary" type="button" data-bs-toggle="collapse" data-bs-target="#collapseBranding" aria-expanded="true" aria-controls="collapseBranding">
          <i class="bi bi-chevron-down"></i>
        </button>
      </div>
      <div id="collapseBranding" class="collapse mt-3" data-bs-parent="#websiteSettingsAccordion">
      <div class="row g-3 align-items-end">
        <div class="col-md-3">
          <label class="form-label">Primary Color</label>
          {{ form.primary_color }}
        </div>
        <div class="col-md-3">
          <label class="form-label">Secondary Color</label>
          {{ form.secondary_color }}
        </div>
        <div class="col-md-3">
          <label class="form-label">Logo File</label>
          {{ form.logo }}
          <div class="form-text">Upload a PNG/SVG. If set, overrides Logo URL.</div>
        </div>
        <div class="col-md-3">
          <label class="form-label">Favicon File</label>
          {{ form.favicon }}
          <div class="form-text">Upload a 32x32 PNG/ICO. If set, overrides Favicon URL.</div>
        </div>
        <div class="col-md-3">
          <label class="form-label">Logo URL</label>
          {{ form.logo_url }}
        </div>
        <div class="col-md-3">
          <label class="form-label">Favicon URL</label>
          {{ form.favicon_url }}
        </div>
      </div>
      </div>
    </div>

    <div class="p-3 border-bottom">
      <div class="d-flex justify-content-between align-items-center">
        <h5 class="mb-0">Hero Section</h5>
        <button class="btn btn-sm btn-outline-secondary" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHero" aria-expanded="true" aria-controls="collapseHero">
          <i class="bi bi-chevron-down"></i>
        </button>
      </div>
      <div id="collapseHero" class="collapse mt-3" data-bs-parent="#websiteSettingsAccordion">
      <div class="row g-3">
        <div class="col-md-6">
          <label class="form-label">Title</label>
          {{ form.hero_title }}
        </div>
        <div class="col-md-6">
          <label class="form-label">Subtitle</label>
          {{ form.hero_subtitle }}
        </div>
        <div class="col-md-6">
          <label class="form-label">Background Image URL</label>
          {{ form.hero_background_url }}
        </div>
        <div class="col-md-3">
          <label class="form-label">Background Video File</label>
          {{ form.hero_video }}
          <div class="form-text">MP4 recommended. If set, overrides Background Video URL.</div>
        </div>
        <div class="col-md-3">
          <label class="form-label">Background Video URL</label>
          {{ form.hero_video_url }}
          <div class="form-text">Direct video URL (MP4) is ideal. Used if no file is uploaded.</div>
        </div>
        <div class="col-md-3">
          <label class="form-label">CTA Text</label>
          {{ form.hero_cta_text }}
        </div>
        <div class="col-md-3">
          <label class="form-label">CTA Link</label>
          {{ form.hero_cta_link }}
        </div>
      </div>
      </div>
    </div>

    <div class="p-3 border-bottom">
      <div class="d-flex justify-content-between align-items-center">
        <h5 class="mb-0">About Section</h5>
        <button class="btn btn-sm btn-outline-secondary" type="button" data-bs-toggle="collapse" data-bs-target="#collapseAbout" aria-expanded="true" aria-controls="collapseAbout">
          <i class="bi bi-chevron-down"></i>
        </button>
      </div>
      <div id="collapseAbout" class="collapse mt-3" data-bs-parent="#websiteSettingsAccordion">
      <div class="row g-3">
        <div class="col-md-4">
          <label class="form-label">About Title</label>
          {{ form.about_title }}
        </div>
        <div class="col-md-8">
          <label class="form-label">About Text</label>
          {{ form.about_text }}
        </div>
      </div>
      </div>
    </div>

    <div class="p-3 border-bottom">
      <div class="d-flex justify-content-between align-items-center">
        <h5 class="mb-0">Contact & Social</h5>
        <button class="btn btn-sm btn-outline-secondary" type="button" data-bs-toggle="collapse" data-bs-target="#collapseContact" aria-expanded="true" aria-controls="collapseContact">
          <i class="bi bi-chevron-down"></i>
        </button>
      </div>
      <div id="collapseContact" class="collapse mt-3" data-bs-parent="#websiteSettingsAccordion">
      <div class="row g-3">
        <div class="col-md-4">
          <label class="form-label">Email</label>
          {{ form.contact_email }}
        </div>
        <div class="col-md-4">
          <label class="form-label">Phone</label>
          {{ form.contact_phone }}
        </div>
        <div class="col-md-4">
          <label class="form-label">Address</label>
          {{ form.contact_address }}
        </div>
        <div class="col-md-4">
          <label class="form-label">Facebook URL</label>
          {{ form.facebook_url }}
        </div>
        <div class="col-md-4">
          <label class="form-label">Twitter/X URL</label>
          {{ form.twitter_url }}
        </div>
        <div class="col-md-4">
          <label class="form-label">Instagram URL</label>
          {{ form.instagram_url }}
        </div>
        <div class="col-12">
          <label class="form-label">Footer Text</label>
          {{ form.footer_text }}
        </div>
      </div>
      </div>
    </div>

    <div class="p-3 d-flex gap-2">
      <button type="submit" name="save_settings" class="btn btn-primary">Save Changes</button>
      <a href="{% url 'landing_page' %}" class="btn btn-outline-secondary" target="_blank">View Public Site</a>
    </div>
  </form>

  <div class="shadow-sm bg-white rounded-3 mt-3">
    <div class="p-3 border-bottom d-flex justify-content-between align-items-center">
      <div>
        <h5 class="mb-1">Categories (Navbar)</h5>
        <p class="text-muted mb-0">Add quick links that will appear in the public navbar.</p>
      </div>
      <button class="btn btn-sm btn-outline-secondary" type="button" data-bs-toggle="collapse" data-bs-target="#collapseCategoriesNav" aria-expanded="true" aria-controls="collapseCategoriesNav">
        <i class="bi bi-chevron-down"></i>
      </button>
    </div>
    <div id="collapseCategoriesNav" class="collapse" data-bs-parent="#websiteSettingsAccordion">
      <div class="p-3">
      <form method="post" class="row g-3">
        {% csrf_token %}
        <div class="col-md-4">
          <label class="form-label">Name</label>
          {{ category_form.name }}
        </div>
        <div class="col-md-12">
          <label class="form-label">Description</label>
          {{ category_form.description }}
        </div>
        <div class="col-md-12">
          <label class="form-label">Video Side Text <small class="text-muted">(for Video template)</small></label>
          {{ category_form.video_side_text }}
        </div>
        <div class="col-md-4">
          <label class="form-label">Template</label>
          {{ category_form.template }}
        </div>
        <div class="col-md-2">
          <label class="form-label">Order</label>
          {{ category_form.order }}
        </div>
        <div class="col-md-1 d-flex align-items-end">
          <div class="form-check">
            {{ category_form.is_active }}
            <label class="form-check-label">Active</label>
          </div>
        </div>
        {% if edit_category %}
          <input type="hidden" name="category_id" value="{{ edit_category.id }}" />
          <div class="col-12 d-flex gap-2">
            <button type="submit" name="save_category" class="btn btn-primary">Save Category</button>
            <a href="{% url 'admin_website_settings' %}" class="btn btn-outline-secondary">Cancel</a>
            <button type="submit" name="delete_category" class="btn btn-outline-danger" onclick="return confirm('Delete this category? This cannot be undone.');">Delete</button>
          </div>
          <div class="form-text">Editing: <strong>{{ edit_category.name }}</strong></div>
        {% else %}
          <div class="col-12">
            <button type="submit" name="add_category" class="btn btn-primary">Add Category</button>
          </div>
        {% endif %}
      </form>

      <div class="table-responsive mt-3">
        <table class="table align-middle">
          <thead>
            <tr>
              <th>#</th>
              <th>Name</th>
              <th>Order</th>
              <th>Status</th>
              <th>Template</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for c in categories %}
            <tr>
              <td>{{ forloop.counter }}</td>
              <td>{{ c.name }}</td>
              <td>{{ c.order }}</td>
              <td>
                {% if c.is_active %}<span class="badge bg-success">Active</span>{% else %}<span class="badge bg-secondary">Hidden</span>{% endif %}
              </td>
              <td><code>{{ c.template }}</code></td>
              <td class="text-nowrap">
                <button type="button" class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#editCategoryModal-{{ c.id }}">Edit</button>
                <button type="button" class="btn btn-sm btn-outline-danger" data-bs-toggle="modal" data-bs-target="#deleteCategoryModal-{{ c.id }}">Delete</button>
              </td>
            </tr>
            {% empty %}
            <tr><td colspan="6" class="text-muted">No categories yet.</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      </div>
    </div>
  </div>

  {% if categories %}
  <div class="shadow-sm bg-white rounded-3 mt-3">
    <div class="p-3 border-bottom d-flex justify-content-between align-items-center">
      <div class="d-flex align-items-center gap-3">
        <h5 class="mb-0">Preview (Categories)</h5>
        <small class="text-muted">Reflects saved data and selected templates</small>
      </div>
      <button class="btn btn-sm btn-outline-secondary" type="button" data-bs-toggle="collapse" data-bs-target="#collapsePreview" aria-expanded="true" aria-controls="collapsePreview">
        <i class="bi bi-chevron-down"></i>
      </button>
    </div>
    <div id="collapsePreview" class="collapse" data-bs-parent="#websiteSettingsAccordion">
      <div class="p-3">
      <div class="row g-3">
        {% for c in categories %}
        <div class="col-md-6">
          <div class="mb-2"><strong>{{ c.name }}</strong> <span class="text-muted">Â· template: {{ c.template }}</span></div>
          <div>
            {% include c.template_path with c=c %}
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
    </div>
  </div>
  {% endif %}
  
</div>
{% endblock %}
